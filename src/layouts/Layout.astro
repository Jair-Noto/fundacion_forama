---
import '../styles/global.css';
import Footer from '../components/shared/Footer.astro';
import { ViewTransitions } from 'astro:transitions';

interface Props {
  title: string;
  description?: string;
  image?: string; // ‚úÖ NUEVO: Prop para imagen personalizada por p√°gina
}

const { 
  title, 
  description = 'Fundaci√≥n Flora Amaz√≥nica - Impulsando el desarrollo sostenible en la Amazon√≠a boliviana',
  image = '/imags/material_quienes_somos/foramaSocial.jpg' // ‚úÖ Imagen por defecto si no se pasa ninguna
} = Astro.props;

// Construir URLs absolutas
const canonicalURL = new URL(Astro.url.pathname, Astro.site || Astro.url.origin).href;
const socialImageURL = new URL(image, Astro.site || Astro.url.origin).href;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    
    {/* ‚úÖ SEO ESENCIAL */}
    <title>{title} | FORAMA</title>
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    
    {/* ‚úÖ CANONICAL */}
    <link rel="canonical" href={canonicalURL} />
    
    {/* ‚úÖ FAVICON */}
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    {/* ‚úÖ OPEN GRAPH (Facebook, WhatsApp, LinkedIn) - ¬°MEJORADO! */}
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={`${title} | FORAMA`} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={socialImageURL} /> {/* La imagen que se ve al compartir */}
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="FORAMA" />
    <meta property="og:locale" content="es_BO" />
    
    {/* ‚úÖ TWITTER CARD (X) - ¬°MEJORADO! */}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={`${title} | FORAMA`} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={socialImageURL} />
    
    {/* ‚úÖ FUENTES (Tus optimizaciones originales) */}
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link 
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" 
      rel="stylesheet"
    />
    <link 
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" 
      rel="stylesheet"
    />
    
    {/* ‚úÖ ASTRO VIEW TRANSITIONS */}
    <ViewTransitions />

    {/* ============================================== */}
    {/* üåç SISTEMA DE TRADUCCI√ìN (Tu c√≥digo intacto) */}
    {/* ============================================== */}
    <script is:inline>
      (function() {
        try {
          var lang = localStorage.getItem('forama_lang');
          if (lang && lang !== 'es') {
            document.documentElement.classList.add('translating-cloak');
          }
        } catch (e) {
          console.error('Error loading language preference:', e);
        }
      })();
    </script>
  </head>
  
  <body class="bg-gray-50 text-gray-800 font-sans flex flex-col min-h-screen">
    
    <div transition:name="main-content" class="flex flex-col flex-grow w-full">
      
      {/* Background (Tus estilos originales) */}
      <div class="fixed inset-0 -z-10 h-full w-full bg-white">
        <div 
          class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]"
          aria-hidden="true"
        ></div>
        <div 
          class="absolute top-0 left-0 right-0 h-[500px] w-full bg-[radial-gradient(circle_800px_at_50%_-100px,#4ade8020,transparent)]"
          aria-hidden="true"
        ></div>
        <div 
          class="absolute bottom-0 right-0 h-[500px] w-[500px] bg-[radial-gradient(circle_400px_at_100%_100%,#f9731615,transparent)]"
          aria-hidden="true"
        ></div>
      </div>
      
      <main id="main-content" class="flex-grow">
        <slot />
      </main>
      
      <Footer />
    </div>

    {/* ============================================== */}
    {/* üåç SCRIPTS DE GOOGLE TRANSLATE (Tus scripts) */}
    {/* ============================================== */}
    <div transition:persist="google-translate">
      <div id="google_translate_element" style="display:none;"></div>

      <script is:inline>
        window.googleTranslateElementInit = function() {
          new google.translate.TranslateElement({
            pageLanguage: 'es', 
            includedLanguages: 'es,en,pt', 
            autoDisplay: false
          }, 'google_translate_element');
        };
      </script>
      
      <script 
        is:inline 
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
        async
      ></script>

      <script is:inline>
        function setGoogleCookie(langValue) {
          var d = new Date();
          d.setTime(d.getTime() + (30 * 24 * 60 * 60 * 1000));
          var expires = "expires=" + d.toUTCString();
          
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=" + window.location.hostname;
          
          if (langValue !== 'es') {
            var cookieValue = "/es/" + langValue;
            document.cookie = "googtrans=" + cookieValue + ";" + expires + ";path=/";
          }
        }

        window.doGTranslate = function(lang_pair) {
          try {
            if (!lang_pair) return;
            
            var lang = lang_pair.split('|')[1];
            setGoogleCookie(lang);
            localStorage.setItem('forama_lang', lang);
            
            var teCombo = document.querySelector('.goog-te-combo');
            if (teCombo) {
              teCombo.value = lang;
              teCombo.dispatchEvent(new Event('change'));
            }
            
            if (lang === 'es') {
              document.documentElement.classList.remove('translating-cloak');
            }
          } catch(err) {
            console.error('Translation error:', err);
          }
        }
      </script>
    </div>

    <script is:inline>
      document.addEventListener('astro:page-load', () => {
        const savedLang = localStorage.getItem('forama_lang');
        
        if (!savedLang || savedLang === 'es') {
          document.documentElement.classList.remove('translating-cloak');
          return;
        }

        if (savedLang && savedLang !== 'es') {
          let attempts = 0;
          const maxAttempts = 20;
          
          const interval = setInterval(() => {
            const teCombo = document.querySelector('.goog-te-combo');
            attempts++;

            if (teCombo) {
              teCombo.value = savedLang;
              teCombo.dispatchEvent(new Event('change'));
              
              setTimeout(() => {
                document.documentElement.classList.remove('translating-cloak');
              }, 100);
              
              clearInterval(interval);
            } 
            else if (attempts > maxAttempts) {
              document.documentElement.classList.remove('translating-cloak');
              clearInterval(interval);
              console.warn('Translation timeout - showing page anyway');
            }
          }, 100);
        }
      });
    </script>

    <style is:global>
      html.translating-cloak body { 
        opacity: 0 !important; 
        visibility: hidden !important; 
        transition: none !important; 
      }
      
      body { 
        opacity: 1; 
        visibility: visible; 
        transition: opacity 0.3s ease-in-out; 
      }
      
      .goog-te-banner-frame,
      iframe.goog-te-banner-frame,
      .skiptranslate,
      body > .skiptranslate,
      .goog-tooltip,
      .goog-te-gadget-icon,
      #goog-gt-tt { 
        display: none !important; 
        visibility: hidden !important; 
        height: 0 !important; 
        width: 0 !important; 
      }
      
      body { 
        top: 0px !important; 
        position: static !important; 
      }
      
      font { 
        background-color: transparent !important; 
        box-shadow: none !important; 
      }
      
      html {
        scroll-behavior: smooth;
      }
      
      *:focus-visible {
        outline: 2px solid #4ade80;
        outline-offset: 2px;
      }
    </style>
  </body>
</html>