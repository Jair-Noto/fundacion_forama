---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/shared/Navbar.jsx';
import { 
  Scale, 
  Leaf, 
  Handshake, 
  MapPin, 
  Clock, 
  BookOpen, 
  ShieldCheck, 
  ChevronDown 
} from 'lucide-react';

// ‚úÖ OPTIMIZACI√ìN 1: Datos estructurados
const identidadSections = [
  {
    id: 'identidad-institucional',
    icon: BookOpen,
    title: 'Identidad Institucional',
    color: 'amazon',
    description: 'FORAMA Amaz√≥nica es una entidad de derecho privado, sin fines de lucro. Nuestros recursos se reinvierten √≠ntegramente en la misi√≥n de conservar el bosque, sin distribuci√≥n de utilidades.',
    highlight: 'sin fines de lucro',
    delay: 0
  },
  {
    id: 'naturaleza-enfoque',
    icon: Handshake,
    title: 'Naturaleza y Enfoque',
    color: 'blue',
    description: 'Somos el puente entre la ciencia y la tradici√≥n. Promovemos el desarrollo sostenible integrando dimensiones ambientales, socioculturales y econ√≥micas en cooperaci√≥n con comunidades y aliados.',
    highlight: 'ambientales, socioculturales y econ√≥micas',
    delay: 200
  }
];

const marcoLegal = [
  {
    id: 'domicilio',
    icon: MapPin,
    title: 'Domicilio Legal',
    value: 'Cobija, Pando',
    subtitle: 'Bolivia',
    color: 'green',
    delay: 0
  },
  {
    id: 'duracion',
    icon: Clock,
    title: 'Duraci√≥n',
    value: 'Indefinida',
    subtitle: 'Compromiso perpetuo.',
    color: 'blue',
    delay: 100
  }
];

const principios = [
  {
    id: 'sostenibilidad',
    imagen: '/imags/material_quienes_somos/ambiente.jpg',
    icon: Leaf,
    titulo: 'Sostenibilidad Ambiental',
    descripcion: 'Buscamos el equilibrio perpetuo entre el desarrollo humano y la conservaci√≥n de la naturaleza.',
    color: 'green',
    gradient: 'from-amazon-950 via-amazon-900/60'
  },
  {
    id: 'equidad',
    imagen: '/imags/material_quienes_somos/equidad.jpg',
    icon: Scale,
    titulo: 'Equidad Social',
    descripcion: 'Garantizamos oportunidades justas y dignidad para todas las comunidades aliadas.',
    color: 'blue',
    gradient: 'from-blue-950 via-blue-900/60'
  },
  {
    id: 'colaboracion',
    imagen: '/imags/material_quienes_somos/comunidad.jpg',
    icon: Handshake,
    titulo: 'Colaboraci√≥n Intercultural',
    descripcion: 'Fomentamos el respeto profundo y el di√°logo de saberes entre ciencia y tradici√≥n.',
    color: 'orange',
    gradient: 'from-orange-950 via-orange-900/60'
  },
  {
    id: 'normativa',
    imagen: '/imags/material_quienes_somos/planta.jpg',
    icon: ShieldCheck,
    titulo: 'Derechos y Normativa',
    descripcion: 'Actuamos con estricto apego a los DDHH y a la normativa ambiental vigente.',
    color: 'purple',
    gradient: 'from-purple-950 via-purple-900/60'
  }
];
---

<Layout 
  title="Qui√©nes Somos" 
  description="Conoce a FORAMA Amaz√≥nica: identidad, naturaleza, principios y marco legal de nuestra fundaci√≥n dedicada a la conservaci√≥n en Pando, Bolivia"
>
  {/* ‚úÖ OPTIMIZACI√ìN 2: Navbar persistente */}
  <Navbar client:load transition:persist />

  <main>
    
    {/* ‚úÖ OPTIMIZACI√ìN 3: Hero con imagen de fondo optimizada */}
    <section 
      class="relative h-screen flex items-center justify-center bg-amazon-900 text-white overflow-hidden"
      aria-labelledby="hero-heading"
    >
      {/* ‚úÖ OPTIMIZACI√ìN 4: Imagen con loading eager (cr√≠tica) */}
      <img 
        src="/imags/material_quienes_somos/team.jpg" 
        alt="Equipo de la Fundaci√≥n Flora Amaz√≥nica trabajando en campo" 
        class="absolute inset-0 w-full h-full object-cover transform scale-105"
        loading="eager"
        width="1920"
        height="1080"
      />
      
      <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/30 to-black/80 z-0" aria-hidden="true"></div>
      
      <div class="relative z-10 container mx-auto px-4 text-center">
        <span class="inline-flex items-center gap-2 py-1.5 px-5 rounded-full
                    bg-gradient-to-r from-emerald-500/20 via-teal-400/15 to-lime-400/15
                    backdrop-blur-md
                    border border-white/10
                    text-white font-semibold uppercase text-[10px]
                    tracking-[0.32em] mb-8
                    shadow-[0_10px_30px_rgba(0,0,0,0.35)]
                    [text-shadow:0_2px_12px_rgba(0,0,0,0.4)]
                    animate-[fadeUp_700ms_ease-out_both]">
          <span class="w-1.5 h-1.5 rounded-full bg-lime-200/90 shadow-[0_0_14px_rgba(163,230,53,0.75)]" aria-hidden="true"></span>
          Institucional
        </span>

        <h1 
          id="hero-heading"
          class="relative font-serif text-6xl md:text-8xl lg:text-9xl font-semibold
                    mb-7 tracking-tight leading-[0.9] text-white
                    animate-[heroTitle_900ms_cubic-bezier(.2,.8,.2,1)_both]
                    [text-shadow:0_2px_0_rgba(0,0,0,0.55),0_10px_30px_rgba(0,0,0,0.55)]
                    [-webkit-text-stroke:2px_rgba(0,0,0,0.45)]"
        >
          Qui√©nes Somos
        </h1>

        <p class="relative font-serif text-xl md:text-3xl lg:text-4xl font-medium
                mb-7 tracking-tight leading-tight text-white
                [text-shadow:0_2px_0_rgba(0,0,0,0.65),0_10px_26px_rgba(0,0,0,0.55)]
                [-webkit-text-stroke:1px_rgba(0,0,0,0.35)]">
          La fuerza detr√°s de la conservaci√≥n:
          <br class="hidden md:block"/>
          <span class="italic font-serif font-semibold">
            nuestra identidad, naturaleza y principios.
          </span>
        </p>
      </div>

      <div class="absolute bottom-10 z-20 animate-bounce">
        <ChevronDown size={40} className="text-white/70" aria-hidden="true" />
      </div>
    </section>

    {/* ‚úÖ OPTIMIZACI√ìN 5: Secci√≥n de identidad con sem√°ntica mejorada */}
    <section 
      id="identidad" 
      class="py-40 bg-white relative overflow-hidden scroll-trigger"
      aria-labelledby="identidad-heading"
    > 
      {/* Background decorativo */}
      <div class="absolute top-0 right-0 -mt-20 -mr-20 w-96 h-96 bg-amazon-50 rounded-full blur-3xl opacity-50" aria-hidden="true"></div>
      <div class="absolute bottom-0 left-0 -mb-20 -ml-20 w-96 h-96 bg-earth-50 rounded-full blur-3xl opacity-50" aria-hidden="true"></div>

      <div class="container mx-auto px-4 max-w-7xl relative z-10">
        <div class="grid lg:grid-cols-2 gap-24 items-start">
          
          {/* ‚úÖ OPTIMIZACI√ìN 6: Contenido estructurado con map */}
          <div class="space-y-24">
            {identidadSections.map((section) => {
              const Icon = section.icon;
              return (
                <article 
                  id={section.id}
                  class="group scroll-element fade-up transition-all duration-1000 ease-out opacity-0 translate-y-20"
                  style={`transition-delay: ${section.delay}ms`}
                >
                  <header class="flex items-center gap-6 mb-8">
                    <div class={`w-16 h-16 bg-${section.color}-100 rounded-2xl flex items-center justify-center text-${section.color}-600 group-hover:bg-${section.color}-600 group-hover:text-white transition-all duration-500 shadow-sm`}>
                      <Icon size={32} aria-hidden="true" />
                    </div>
                    <h2 class="text-4xl font-bold text-amazon-900 tracking-tight">{section.title}</h2>
                  </header>
                  
                  <div class={`pl-4 border-l-4 border-${section.color}-200 group-hover:border-${section.color}-500 transition-colors duration-500`}>
                    <p class="text-gray-700 leading-loose text-lg text-pretty pl-6">
                      {section.description.split(section.highlight)[0]}
                      <strong class={`text-${section.color}-700 font-bold`}>{section.highlight}</strong>
                      {section.description.split(section.highlight)[1]}
                    </p>
                  </div>
                </article>
              );
            })}
          </div>

          {/* ‚úÖ OPTIMIZACI√ìN 7: Imagen sticky con lazy loading */}
          <aside class="relative lg:sticky lg:top-32 scroll-element fade-up delay-500 opacity-0 transition-all duration-1000"> 
            <div class="relative rounded-[2.5rem] overflow-hidden shadow-2xl group">
              <img 
                src="/imags/material_quienes_somos/apoyo.jpg" 
                alt="Miembros de FORAMA trabajando junto a comunidades locales en Pando" 
                class="w-full h-auto object-cover transform group-hover:scale-110 transition duration-1000"
                loading="lazy"
                width="600"
                height="800"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-amazon-900/80 via-transparent to-transparent" aria-hidden="true"></div>
              
              <blockquote class="absolute bottom-8 left-8 right-8 text-white">
                <p class="font-serif italic text-xl">"El bosque vive si la comunidad prospera."</p>
              </blockquote>
            </div>
          </aside>

        </div>
      </div>
    </section>

    <section 
      id="principios" 
      class="py-40 bg-stone-50 scroll-trigger relative"
      aria-labelledby="principios-heading"
    >
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-gray-200 via-stone-50 to-stone-50 opacity-70 pointer-events-none" aria-hidden="true"></div>

      <div class="container mx-auto px-4 max-w-7xl relative z-10">
        
        <header class="text-center mb-24 scroll-element fade-up opacity-0 translate-y-20">
          <span class="text-amazon-600 font-bold tracking-widest uppercase text-sm mb-4 block">Nuestros Pilares</span>
          <h2 id="principios-heading" class="text-4xl md:text-6xl font-extrabold text-amazon-900 mb-6 tracking-tight leading-tight">
            Principios que Gu√≠an<br aria-hidden="true"/>Nuestra Huella
          </h2>
          <p class="text-xl text-gray-500 max-w-2xl mx-auto font-light leading-relaxed">
            Valores inquebrantables que sostienen cada decisi√≥n en el territorio.
          </p>
        </header>

        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
          {principios.map((principio, index) => {
            const Icon = principio.icon;
            return (
              <article 
                id={principio.id}
                class="group relative h-[450px] rounded-[2.5rem] overflow-hidden shadow-xl hover:shadow-2xl transition-all duration-500 scroll-element fade-up delay-100 opacity-0 translate-y-20"
              >
                <img 
                  src={principio.imagen} 
                  alt={`${principio.titulo} - ${principio.descripcion}`}
                  class="absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110"
                  loading="lazy"
                  width="400"
                  height="450"
                />
                
                <div class={`absolute inset-0 bg-gradient-to-t ${principio.gradient} to-black/30 opacity-80 group-hover:opacity-90 transition-opacity duration-500`} aria-hidden="true"></div>

                <div class="relative z-20 p-10 h-full flex flex-col justify-end">
                  <div class={`w-16 h-16 mb-6 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/30 group-hover:bg-${principio.color}-500/30 transition-colors duration-500`}>
                    <Icon size={32} className="text-white" aria-hidden="true" />
                  </div>
                  <h3 class="text-2xl font-extrabold text-white mb-4">{principio.titulo}</h3>
                  <p class="text-gray-200 leading-relaxed text-sm font-light">{principio.descripcion}</p>
                </div>
              </article>
            );
          })}
        </div>
      </div>
    </section>


    {/* ‚úÖ OPTIMIZACI√ìN 8: Marco legal con datos estructurados */}
    <section 
      id="legal" 
      class="relative py-40 overflow-hidden scroll-trigger"
      aria-labelledby="legal-heading"
    >
      <img 
        src="/imags/material_quienes_somos/pando.jpg" 
        alt="" 
        class="absolute inset-0 w-full h-full object-cover transform scale-105"
        loading="lazy"
        aria-hidden="true"
      />
      
      <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/30 to-black/80 z-0" aria-hidden="true"></div>

      <div class="container mx-auto px-4 max-w-6xl relative z-10">
        
        <header class="text-center mb-16 scroll-element fade-up opacity-0 translate-y-10">
          <span class="text-green-300 font-bold tracking-widest uppercase text-sm">Marco Legal</span>
          <h2 id="legal-heading" class="text-4xl md:text-5xl font-extrabold text-white mt-2">Nuestra Base Operativa</h2>
        </header>

        <div class="grid md:grid-cols-2 gap-10">
          {marcoLegal.map((item) => {
            const Icon = item.icon;
            return (
              <article 
                id={item.id}
                class="bg-white/10 backdrop-blur-md border border-white/20 p-10 rounded-3xl flex items-center gap-8 hover:bg-white/15 transition-all duration-300 group scroll-element fade-up opacity-0 translate-y-20"
                style={`transition-delay: ${item.delay}ms`}
              >
                <div class={`w-20 h-20 rounded-full bg-${item.color}-500/20 flex items-center justify-center border border-${item.color}-400/30 group-hover:scale-110 transition-transform`}>
                  <Icon size={40} className={`text-${item.color}-400`} aria-hidden="true" />
                </div>
                <div>
                  <p class="text-amazon-200 text-sm font-bold uppercase tracking-wider mb-1">{item.title}</p>
                  <h3 class="text-4xl font-bold text-white mb-2">{item.value}</h3>
                  {item.id === 'domicilio' ? (
                    <div class="flex items-center gap-2 text-white/80">
                      <img 
                        src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Bandera_de_Bolivia_%28Estado%29.svg/1200px-Bandera_de_Bolivia_%28Estado%29.svg.png" 
                        alt="" 
                        class="w-6 h-4 rounded-sm object-cover"
                        loading="lazy"
                        aria-hidden="true"
                      />
                      <span>{item.subtitle}</span>
                    </div>
                  ) : (
                    <p class="text-white/80 text-sm">{item.subtitle}</p>
                  )}
                </div>
              </article>
            );
          })}
        </div>

        {/* ‚îÄ‚îÄ BOT√ìN WEBMAIL CENTRALIZADO ‚îÄ‚îÄ */}
        <div class="flex justify-center mt-14">
          <div class="flex flex-col items-center gap-4">
            
            <p class="text-white/50 text-xs font-semibold uppercase tracking-[0.25em]">
              Plataforma de Correo Institucional FORAMA 
            </p>

            <a 
              href="https://cloud-8a6711.managed-vps.net/spanel/login/webmail"
              id="webmail-btn"
              target="_blank"
              rel="noopener noreferrer"
              class="group relative inline-flex items-center justify-center gap-3
                      px-8 py-4 rounded-2xl
                      bg-white/10 backdrop-blur-md 
                      border border-white/20
                      text-white font-bold text-sm uppercase tracking-[0.15em]
                      shadow-[0_8px_32px_rgba(0,0,0,0.3),inset_0_1px_0_rgba(255,255,255,0.15)]
                      hover:bg-white/18 hover:border-white/35
                      hover:shadow-[0_12px_40px_rgba(0,0,0,0.4),0_0_0_1px_rgba(255,255,255,0.15)]
                      hover:-translate-y-0.5
                      active:scale-[0.98] active:translate-y-0
                      transition-all duration-200
                      focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50"
              aria-label="Acceder al correo institucional en nueva pesta√±a"
              data-webmail-url="https://cloud-8a6711.managed-vps.net/spanel/login/webmail"
            >
              {/* √çcono envelope */}
              <span class="w-9 h-9 rounded-xl bg-white/10 border border-white/15 flex items-center justify-center shrink-0 group-hover:bg-white/15 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <rect width="20" height="16" x="2" y="4" rx="2"/>
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                </svg>
              </span>

              <span>Acceder al Webmail</span>

              {/* Flecha ‚Üí */}
              <svg 
                xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" 
                class="opacity-60 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200"
                aria-hidden="true"
              >
                <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
              </svg>
            </a>


          </div>
        </div>

      </div>
      <script>
          // üõ°Ô∏è CAPA 1: Whitelist de URLs permitidas
          const ALLOWED_WEBMAIL_URLS = [
            'https://cloud-8a6711.managed-vps.net/spanel/login/webmail'
          ];

          // üõ°Ô∏è CAPA 2: Funci√≥n de sanitizaci√≥n de URLs
          function sanitizeUrl(url: string): string | null {
            try {
              const parsedUrl = new URL(url);
              
              // Solo permitir HTTPS
              if (parsedUrl.protocol !== 'https:') {
                console.error('üö® Solo se permiten URLs HTTPS');
                return null;
              }
              
              // Verificar que est√° en la whitelist
              if (!ALLOWED_WEBMAIL_URLS.includes(url)) {
                console.error('üö® URL no est√° en la lista de permitidas');
                return null;
              }
              
              return url;
            } catch (e) {
              console.error('üö® URL inv√°lida:', e);
              return null;
            }
          }

          // üõ°Ô∏è CAPA 3: Handler seguro para el bot√≥n Webmail
          function handleWebmailClick(event: MouseEvent) {
            event.preventDefault();
            
            const button = event.currentTarget as HTMLElement;
            const webmailUrl = button.getAttribute('data-webmail-url');
            
            // Validar URL
            if (!webmailUrl) {
              alert('Error de seguridad: URL no disponible');
              return false;
            }
            const safeUrl = sanitizeUrl(webmailUrl);
            
            if (!safeUrl) {
              alert('Error de seguridad: URL no v√°lida');
              return false;
            }
            
            // üõ°Ô∏è CAPA 4: Abrir de forma segura
            const newWindow = window.open(safeUrl, '_blank', 'noopener,noreferrer');
            
            // üõ°Ô∏è CAPA 5: Prevenir window.opener exploit
            if (newWindow) {
              newWindow.opener = null;
            }
            
            return false;
          }

          // üõ°Ô∏è CAPA 6: Detectar XSS en par√°metros URL
          function detectXSSInUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const suspiciousPatterns = [
              '<script',
              'javascript:',
              'onerror=',
              'onclick=',
              'onload=',
              'eval(',
              'alert(',
              'document.cookie'
            ];
            
            for (const [key, value] of urlParams.entries()) {
              const lowerValue = value.toLowerCase();
              
              for (const pattern of suspiciousPatterns) {
                if (lowerValue.includes(pattern)) {
                  console.error('üö® Posible ataque XSS detectado en URL');
                  console.error('Par√°metro sospechoso:', key, '=', value);
                  
                  // Redirigir a p√°gina segura
                  window.location.href = '/contacto';
                  return true;
                }
              }
            }
            
            return false;
          }

          // üõ°Ô∏è CAPA 7: Inicializaci√≥n segura
          document.addEventListener('DOMContentLoaded', function() {
            // Detectar XSS
            if (detectXSSInUrl()) {
              return; // Ya se redirigi√≥
            }
            
            // Agregar event listener al bot√≥n
            const webmailBtn = document.getElementById('webmail-btn');
            
            if (webmailBtn) {
              webmailBtn.addEventListener('click', handleWebmailClick);
              
              // üõ°Ô∏è CAPA 8: Prevenir modificaci√≥n del href por JavaScript malicioso
              Object.defineProperty(webmailBtn, 'href', {
                writable: false,
                configurable: false
              });
            }
          });

          // üõ°Ô∏è CAPA 9: Protecci√≥n contra clickjacking
          if (window.top !== window.self && window.top !== null) {
            console.warn('üö® P√°gina cargada en iframe - posible clickjacking');
            // Romper el iframe
            window.top.location.href = window.self.location.href;
          }

          // üõ°Ô∏è CAPA 10: Log de intentos de apertura (para monitoreo)
          window.addEventListener('beforeunload', function() {
            // Aqu√≠ podr√≠as enviar analytics o logs a tu servidor
            console.log('‚úÖ Usuario saliendo de la p√°gina de contacto');
          });
        </script>

        {/* ‚úÖ ESTILOS ADICIONALES DE SEGURIDAD */}
        <style>
          /* Prevenir que JavaScript externo modifique elementos cr√≠ticos */
          #webmail-btn {
            pointer-events: auto !important;
          }
          
          /* Protecci√≥n b√°sica contra inyecci√≥n de estilos */
          * {
            -webkit-user-modify: read-only;
          }
        </style>
  
    </section>

    
  </main>

</Layout>

{/* ‚úÖ OPTIMIZACI√ìN 10: Script optimizado con mejor performance */}
<script>
  document.addEventListener('astro:page-load', () => {
    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Animar elementos hijos
          const hiddenElements = entry.target.querySelectorAll('.scroll-element');
          hiddenElements.forEach((el) => {
            el.classList.remove('opacity-0', 'translate-y-20'); 
            el.classList.add('opacity-100', 'translate-y-0');   
          });
          
          // Dejar de observar para mejor performance
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Observar todas las secciones trigger
    document.querySelectorAll('.scroll-trigger').forEach((section) => {
      observer.observe(section);
    });
  });
</script>

{/* ‚úÖ OPTIMIZACI√ìN 11: Estilos optimizados */}
<style>
  /* Delays para animaciones escalonadas */
  .delay-100 { transition-delay: 100ms; }
  .delay-200 { transition-delay: 200ms; }
  .delay-300 { transition-delay: 300ms; }
  .delay-400 { transition-delay: 400ms; }
  .delay-500 { transition-delay: 500ms; }

  /* Optimizaci√≥n GPU para animaciones */
  .scroll-element {
    will-change: opacity, transform;
  }

  /* Asegurar que las animaciones sean suaves */
  @media (prefers-reduced-motion: reduce) {
    .scroll-element,
    .transition-all {
      transition: none;
      animation: none;
    }
  }
</style>